<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="VehiclesByYear"
              pageWidth="595" pageHeight="842" columnWidth="555"
              leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20"
              uuid="cccccccc-1111-2222-3333-dddddddddddd"
              isSummaryNewPage="false">

    <!-- ========================================================= -->
    <!-- SUBDATASET -->
    <!-- (va primero, antes de parámetros, según el orden permitido) -->
    <!-- ========================================================= -->
    <subDataset name="datasetRangos">
        <field name="rango" class="java.lang.String"/>
        <field name="total" class="java.lang.Long"/>
    </subDataset>

    <!-- ========================================================= -->
    <!-- PARÁMETROS -->
    <!-- ========================================================= -->
    <parameter name="RANGOS" class="java.util.Collection"/>

    <!-- ========================================================= -->
    <!-- FONDO -->
    <!-- ========================================================= -->
    <background>
        <band/>
    </background>

    <!-- ========================================================= -->
    <!-- TÍTULO (TEXTO EXPLICATIVO) -->
    <!-- ========================================================= -->
    <title>
        <band height="20">
            <!-- Title intentionally left empty -->
        </band>
    </title>


    <!-- ========================================================= -->
    <!-- ENCABEZADO DE PÁGINA -->
    <!-- ========================================================= -->
    <pageHeader>
        <band height="90">

            <!-- LOGO -->
            <image>
                <reportElement x="0" y="10" width="80" height="60"/>
                <imageExpression><![CDATA[
"C:\\Users\\frang\\OneDrive\\Documentos\\Clases\\POOI\\SistemaContratoGPS\\src\\main\\resources\\media\\SISEK.png"
                ]]></imageExpression>
            </image>

            <!-- TÍTULO PRINCIPAL -->
            <textField>
                <reportElement x="100" y="10" width="350" height="30"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Reporte de Vehículos Registrados por Año"]]></textFieldExpression>
            </textField>

            <!-- FECHA DE IMPRESIÓN -->
            <textField pattern="dd/MM/yyyy HH:mm">
                <reportElement x="400" y="50" width="150" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>

            <!-- LÍNEA SEPARADORA -->
            <line>
                <reportElement x="0" y="80" width="555" height="1"/>
            </line>

        </band>
    </pageHeader>

    <columnHeader>
        <band height="60">

            <!-- DESCRIPCIÓN DEL REPORTE -->
            <textField isStretchWithOverflow="true">
                <reportElement x="0" y="0" width="555" height="35"/>
                <textElement>
                    <font size="10"/>
                </textElement>
                <textFieldExpression><![CDATA[
"Este reporte detalla la cantidad de vehículos registrados por rangos de años. "
+ "El objetivo es facilitar el análisis visual y detectar tendencias en el registro vehicular."
            ]]></textFieldExpression>
            </textField>

            <!-- SEPARADOR -->
            <line>
                <reportElement x="0" y="50" width="555" height="1"/>
            </line>

        </band>
    </columnHeader>


    <!-- ========================================================= -->
    <!-- DETALLE (NO LO USAMOS, PERO DEBE EXISTIR) -->
    <!-- ========================================================= -->
    <detail>
        <band height="1"/>
    </detail>

    <pageFooter>
        <band height="55">

            <!-- Metadata del reporte -->
            <textField isStretchWithOverflow="true">
                <reportElement x="0" y="5" width="350" height="15"/>
                <textElement textAlignment="Left">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[
"Autor: Usuario Admin"
            ]]></textFieldExpression>
            </textField>

            <textField isStretchWithOverflow="true">
                <reportElement x="0" y="20" width="350" height="15"/>
                <textElement textAlignment="Left">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[
"Sistema: Sistema de Contratos GPS"
            ]]></textFieldExpression>
            </textField>

            <textField isStretchWithOverflow="true">
                <reportElement x="0" y="35" width="350" height="15"/>
                <textElement textAlignment="Left">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[
"Código del reporte: GPS-RPT-001"
            ]]></textFieldExpression>
            </textField>

            <!-- Número de página -->
            <textField>
                <reportElement x="400" y="35" width="150" height="15"/>
                <textElement textAlignment="Right">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[
"Página " + $V{PAGE_NUMBER}
            ]]></textFieldExpression>
            </textField>

        </band>
    </pageFooter>



    <!-- ========================================================= -->
    <!-- RESUMEN (GRÁFICO DE BARRAS) -->
    <!-- ========================================================= -->
    <summary>
        <band height="380">

            <barChart>
                <chart>
                    <reportElement x="20" y="20" width="500" height="300"/>
                    <chartTitle>
                        <titleExpression><![CDATA["Vehículos Registrados por Año"]]></titleExpression>
                    </chartTitle>
                </chart>

                <categoryDataset>
                    <dataset>
                        <datasetRun subDataset="datasetRangos">
                            <dataSourceExpression><![CDATA[
new net.sf.jasperreports.engine.data.JRMapCollectionDataSource($P{RANGOS})
                            ]]></dataSourceExpression>
                        </datasetRun>
                    </dataset>

                    <categorySeries>
                        <seriesExpression><![CDATA["Vehículos"]]></seriesExpression>
                        <categoryExpression><![CDATA[$F{rango}]]></categoryExpression>
                        <valueExpression><![CDATA[$F{total}]]></valueExpression>
                    </categorySeries>
                </categoryDataset>

                <barPlot>
                    <plot/>
                    <categoryAxisFormat>
                        <axisFormat>
                            <labelFont>
                                <font size="7"/>
                            </labelFont>
                        </axisFormat>
                    </categoryAxisFormat>
                </barPlot>

            </barChart>

        </band>
    </summary>

</jasperReport>
